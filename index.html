<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>reveal.js - The HTML Presentation Framework</title>

		<meta name="description" content="A framework for easily creating beautiful presentations using HTML">
		<meta name="author" content="Hakim El Hattab">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/night.css" id="theme">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<h1>Don't Hurt Yourself</h1>
					<h3>Adopting AngularJS in Existing Applications</h3>
					<h4>
						<a href="http://www.alexandraatzl.com">Alexandra Atzl</a> | <a href="http://twitter.com/alexandraatzl">@alexandraatzl</a>
					</h4>
					<h4>UI Developer at <a href="http://www.effectiveui.com">EffectiveUI</a> | Rochester, NY</h4>
				</section>

				<section>
					<h2>Disclaimer</h2>
					<aside class="notes">
					1. A lot of this talk may seem obvious to a lot of you. You might think, duh, this is fairly common knowledge. But I've seen apps that don't follow my suggestions, so they're worth mentioning and calling out.
					2. Yes, I'm using $scope. Ideally, I would avoid $scope altogether and use this/controllerAs, but this is based on a real-life example, so I left that part out.
					</aside>
				</section>

				<section>
					<h2>The Problem</h2>
					<aside class="notes">
						You're working for a client, and you're given Angular code that really only uses controllers. You have limited time, budget, and resources, but you need to make this code align more with Angular concepts, and you need it to be more modular, testable, and scalable.
					</aside>
				</section>

				<section>
					<h2>Common Pitfalls</h2>

					<ul>
						<li class="fragment">Placing multiple objects in a single file.</li>
						<li class="fragment">Using global variables</li>
						<li class="fragment">Not using Angular's built-in services.</li>
						<li class="fragment">Putting business logic in controllers</li>
						<li class="fragment">Repeating base objects, constant values, etc.</li>
					</ul>

					<aside class="notes">
					 ex. using setTimeout instead of $timeout, putting 5 controllers in a single file, etc.
					</aside>
				</section>

				<section>
					<h2>Take Advantage of Everything Available</h2>
					<p>If you're given an entire toolbox with which to build a bookshelf, why would you insist on doing everything using only the hammer?</p>
				</section>

				<section>
					<h2>So where do we start?</h2>
				</section>

				<section>
					<section>
						<h2>Break up files.</h2>
						<h4>Every component should have its own folder, and every controller/service/directive should have its own Javascript file.</h4>
					</section>

					<aside class="notes">
						The extra time taken is worth it in the long run. This way, you can more easily find specific files you may need, etc.
					</aside>
				</section>

				<section>
					<aside class="notes">
						<ul>
							<li>service is a singleton, so we know we're only ever dealing with that one instance</li>
							<li>Angular will tell us if another servie of the same name is created, so there's no chance we'll inadvertently overwrite the object or its properties</li>
						</ul>
					</aside>

					<section>
						<h2>Create Services</h2>
						<h4>Eliminate global variables by wrapping them in services.</h4>

						<aside class="notes">
							Most of these can be wrapped in an Angular service, and you can use dependency injection to make them available in the controllers where you need them.
						</aside>
					</section>

					<section>
						<h3>Example: Global Object</h3>
						<pre><code data-trim>
angular.module('app')
	.controller('MyCtrl', function($scope) {
		// What is moment? How do I know this exists and is the object I want?
		$scope.startTime = moment();
		$scope.endTime = moment().add(1, 'h');
	});
						</code></pre>
					</section>

					<section>
						<aside class="notes">
						Advantage: guaranteeing you have it on controller level; also, can set jshint to not allow access to global variables unless you explicitly allow it.
						Plus! Then, you can mock it out when testing.
						</aside>
						<h3>Example: Wrapped in a Service</h3>
						<pre><code data-trim>
angular.module('app')
	.service('moment', function($window) {
		return $window.moment;
	})
	.controller('MyCtrl', function($scope, moment) {
		$scope.startTime = moment();
		$scope.endTime = moment().add(1, 'h');
	});
						</code></pre>
					</section>

					<section>
						<h2>It works for custom objects, too!</h2>
						<h4>Use this  method for any custom global objects you've created as well.</h4>
					</section>

					<section>
						<h3>Example: Global Object</h3>
						<pre>
							<code class="javascript">
var zoo = {
	animals: null,
	getAnimals: function() {
		return this.animals;
	}
}

angular.module('app')
	.controller('ZooCtrl', function($scope) {
		// hope that zoo exists somewhere
		$scope.myAnimals = zoo.getAnimals();
	});
							</code>
						</pre>
					</section>

					<section>
					<aside class="notes">
					you don't have to changemuch, just add a dependency, and set up the globals in a smarter way.
					</aside>
						<h3>Example: Wrapped in a Service</h3>
						<pre>
							<code data-trim>
	angular.module('app')
		.factory('zoo', function(){
			var animals = null;
			return {
				getAnimals: function() {
					return animals;
				}
			};
		})
		.controller('ZooCtrl', function($scope, zoo) {
			$scope.myAnimals = zoo.getAnimals();
		});
							</code>
						</pre>
						<aside class="notes">
							<ul>
								<li>now we can leverage dependency injection</li>
								<li>our code is more modular and more testable</li>
							</ul>
						</aside>
					</section>
				</section>

				<section>
					<section>
						<h2>Use all the tools available to you</h2>
						<h4>Angular's built-in services make life easier. Use them!</h4>
					</section>

					<section>
						<h3>Example: Grabbing data from a server</h3>
						<pre>
							<code data-trim>
	angular.module('app')
		.factory('addressBookService', function(){
			var data = null;

			return {
				getAddresses: function() {
					$.ajax({
						url: '/path/to/data',
						dataType: 'json',
						success: function(result) {
							data = result;
						},
						error: function(error) {}
					});
				}
			};
		});
							</code>
						</pre>
					</section>

					<section>
					<aside class="notes">
						why return the promise itself?? explain.
					</aside>
						<h3>Example: Using Angular's $http service</h3>
						<pre>
							<code data-trim>
	angular.module('app')
		.factory('addressBookService', function($http) {
			return {
				getAddresses: function() {
					return $http({
						method: 'GET',
						url: '/path/to/data'
					});
				}
			};
		})
							</code>
						</pre>
						<aside class="notes">
							<ul>
								<li>using $http lets you use $httpInterceptors, whereas jQuery's $.ajax() will not</li>
								<li>Now you can mock out $http in tests</li>
							</ul>
						</aside>
					</section>

					<section>
					<aside class="notes">

					</aside>
						<h2>frequently forgotten built-in services</h2>
						<h4>
							<ul>
								<li>$http</li>
								<li>$window</li>
								<li>$document</li>
								<li>$location</li>
								<li>$animate</li>
								<li>$filter</li>
								<li>$q</li>
								<li>$timeout</li>
							</ul>
						</h4>
					</section>
				</section>

				<section>
					<section>
						<aside class="notes">
							a lot of times, people learn controllers first, so they put everything in there when they shouldn't.
						</aside>
						<h2>Keep business logic out of controllers</h2>
						<h4>Abstract this logic into services instead.</h4>

						<aside class="notes">

						</aside>
					</section>

				<!-- 	<section>
						<h3>Example: Controller riddled with excess logic</h3>
						<pre>
							<code data-trim>
							// foo
							</code>
						</pre>
					</section>

					<section>
						<h3>Example: Abstracting logic out into a service</h3>
						<pre>
							<code data-trim>
							// bar
							</code>
						</pre>
					</section> -->
				</section>

				<section>
					<aside class="notes">
						<ul>
							<li>sometimes you use globals for constants, configuration objects, etc.</li>
							<li>using Angular.value or angular.constant provides a better way to do that</li>
							<li>then you can use dependency injection</li>
						</ul>
					</aside>
					<section>
						<h2>Utilize Angular Values &amp; Constants</h2>
						<h4>If you commonly need to use the same values, don't add them to every controller individually!</h4>
					</section>

					<section>
						<h3>Example: Repeated Code</h3>
						<pre><code data-trim>
	angular.module('petStoreApp')
		.controller('petStoreOneCtrl', function($scope) {
			$scope.myCat = {
				name: 'Grumpy',
				type: 'cat'
				age: 2
			};

			$scope.myDog = {
				name: 'Lassie',
				type: 'dog',
				age: 4
			};
		})
		.controller('petStoreTwoCtrl', function($scope) {
			$scope.myOtherCat = {
				name: 'Fluffy',
				type: 'cat',
				age: 3
			};
		});
						</code></pre>
					</section>

					<section>
						<h3>Example: Using Angular values</h3>
						<pre>
							<code data-trim>
angular.module('petStoreApp')
	.value('petTypes', {
		CAT: 'cat',
		DOG: 'dog',
		FISH: 'fish'
	})
	.controller('petStoreOneCtrl', function($scope, petTypes) {
		$scope.myCat = {
			name: 'Grumpy',
			type: petTypes.CAT,
			age: 2
		};

		$scope.myDog = {
			name: 'Lassie',
			type: petTypes.DOG,
			age: 4
		};
	})
	.controller('petStoreTwoCtrl', function($scope, petTypes) {
		$scope.myOtherCat = {
			name: 'Fluffy',
			type: petTypes.CAT,
			age: 3
		};
	});
							</code>
						</pre>
					</section>
				</section>

				<section>
					<section>
						<h2>Take things a step further</h2>
						<h4>Do you have multiple services that do <em>almost</em> the same thing? Try creating a base service and extending it for each use case.</h4>

						<aside class="notes">
							More testable! Cleaner!
						</aside>
					</section>

					<section>
						<h3>Example: </h3>
						<pre><code data-trim>
	angular.module('zooApp')
		.service('monkeyService', function($http) {
			var svc = {
				getInfo: function(monkeyId) {
					$http({ method: 'GET', url: 'monkey/' + monkeyId }).then(function(response) {
						return response;
					});
				}
				feed: function(monkeyId, food) {
					$http({
						method: 'PUT',
						url: 'monkey/dinnerTime/' + monkeyId,
						data: food
					}).then(function(response) {
						return response;
					});
				}
			};

			return svc;
		})
		.service('lionService', function($http) {
			var svc = {
				getInfo: function(lionId) {
					$http({ method: 'GET', url: 'lion/' + lionId }).then(function(response) {
						return response;
					});
				},
				feed: function(lionId, food) {
					$http({
						method: 'PUT',
						url: 'lion/dinnerTime/' + lionId,
						data: food
					}).then(function(response) {
						return response;
					});
				}
			};

			return svc;
		});
						</code></pre>
					</section>

					<section>
						<h3>Example: </h3>
						<pre><code data-trim>
	angular.module('zooApp')
		.service('animalService', function($http) {
			var animalSvc = function(_endpoint_) {
				var endpoint = _endpoint_ + '/';

				return {
					getInfo: getInfo,
					feed: feed
				};

				function getInfo(animalId) {
					$http({ method: 'GET', url: endpoint + animalId }).then(function(response) {
						return response;
					});
				};

				function feed(animalId, food) {
					feed: function(animalId, food) {
						$http({
							method: 'PUT',
							url: endpoint + '/dinnerTime/' + animalId,
							data: food
						}).then(function(response) {
							return response;
						});
					}
				}
			};
						</code></pre>
					</section>

					<section>
						<h3>Example: </h3>
						<pre><code data-trim>
angular.module('zooApp')
	.service('monkeyService', function(animalService) {
		var monkeySvc = animalService('monkey');

		return monkeySvc;
	})
	.service('lionService', function(animalService) {
		var lionSvc = animalService('lion');

		return lionSvc;
	});
						</code></pre>
					</section>
				</section>

				<section>
					<section>
						<h2>Take things a step further</h2>
						<h4>What about controllers?</h4>

						<aside class="notes">
							More testable! Cleaner!
						</aside>
					</section>

					<section>
						<h3>Example:</h3>
						<pre><code data-trim>
	angular.module('petStoreApp')
		.controller('grumpiestCatCtrl', function($scope, catService) {
			$scope.cat = catService.getCurrentCat();



		})

						</code></pre>
					</section>

					<section>
						<h3>Example: </h3>
						<pre><code data-trim>
	angular.module('app')...

						</code></pre>

					</section>

					<section>
						<h3>Example:</h3>
						<pre><code data-trim>
	more here...
						</code></pre>
					</section>
				</section>

				<section>
					<h2>Takeaways</h2>

					<aside class="notes">
					We can take steps to incrementally update our code, piece by piece, while still following Angular best practices. and
					</aside>
				</section>
			</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

		</script>

	</body>
</html>
